#!/usr/bin/env bash
set -euo pipefail
IFS=$'\n\t'

if [ $# -gt 0 ]; then
  RAW_NAME="$@"
  NOTE_NAME=$(echo "${RAW_NAME%.*}" )
  FILE_NAME="$(echo "$NOTE_NAME" | tr '[:upper:]' '[:lower:]' | tr ' ' '=')"

  if [[ -f "$HOME/notes/$FILE_NAME.md" ]]; then
    # If the note exists, lets open it up to edit it
    nvim "$HOME/notes/$FILE_NAME.md"
    exit 0
  else
    # If the note does NOT exist, lets initialize it.
    filepath="$HOME/notes/$FILE_NAME.md"
    ref=$(mktemp)
    echo "$NOTE_NAME" > "$ref"
    echo "$NOTE_NAME" | sed 's/./-/g' >> "$ref"
    cat "$ref" > "$filepath"
    echo >> "$filepath"
    echo >> "$filepath"
    nvim -c '+ normal G' "$filepath" && [ "" == "$(diff "$ref" "$filepath")" ] && rm "$filepath" "$ref"
  fi
fi
